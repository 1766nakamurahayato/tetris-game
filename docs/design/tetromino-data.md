# テトリミノデータ構造設計書

**作成日**: 2025-12-27
**対象**: Phase 2 - コア機能実装
**参照**: SRS (Super Rotation System)

## 1. 概要

テトリスの7種類のテトリミノ（I, O, T, S, Z, J, L）のデータ構造を定義します。各テトリミノは4つの回転状態を持ち、4×4のグリッドで表現されます。

## 2. データ構造仕様

### 2.1 基本構造

```javascript
const TETROMINOS = {
  'I': {
    shape: [
      // 4つの回転状態
      [rotation0],
      [rotation1],
      [rotation2],
      [rotation3]
    ],
    color: '#00F0F0'
  },
  // ... 他のテトリミノ
};
```

### 2.2 座標系

- 4×4の2次元配列
- `shape[y][x]` の形式
- 0 = 空セル
- 1 = ブロック

```
  x →
y ┌─┬─┬─┬─┐
↓ │0│1│2│3│
  ├─┼─┼─┼─┤
  │0│0│0│0│ ← row 0
  ├─┼─┼─┼─┤
  │1│1│1│1│ ← row 1
  ├─┼─┼─┼─┤
  │0│0│0│0│ ← row 2
  ├─┼─┼─┼─┤
  │0│0│0│0│ ← row 3
  └─┴─┴─┴─┘
```

## 3. 各テトリミノの詳細定義

### 3.1 I型（シアン - Cyan）

**色**: `#00F0F0`

**回転状態0（水平）**:
```
[0, 0, 0, 0]
[1, 1, 1, 1]
[0, 0, 0, 0]
[0, 0, 0, 0]
```

**回転状態1（垂直）**:
```
[0, 0, 1, 0]
[0, 0, 1, 0]
[0, 0, 1, 0]
[0, 0, 1, 0]
```

**回転状態2（水平）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[1, 1, 1, 1]
[0, 0, 0, 0]
```

**回転状態3（垂直）**:
```
[0, 1, 0, 0]
[0, 1, 0, 0]
[0, 1, 0, 0]
[0, 1, 0, 0]
```

---

### 3.2 O型（黄色 - Yellow）

**色**: `#F0F000`

**回転状態0-3（全て同じ）**:
```
[0, 0, 0, 0]
[0, 1, 1, 0]
[0, 1, 1, 0]
[0, 0, 0, 0]
```

*注意: O型は回転しても形状が変わらないため、全ての回転状態が同一です。*

---

### 3.3 T型（紫 - Purple）

**色**: `#A000F0`

**回転状態0（T字上向き）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[1, 1, 1, 0]
[0, 0, 0, 0]
```

**回転状態1（T字右向き）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[0, 1, 1, 0]
[0, 1, 0, 0]
```

**回転状態2（T字下向き）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[1, 1, 1, 0]
[0, 1, 0, 0]
```

**回転状態3（T字左向き）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[1, 1, 0, 0]
[0, 1, 0, 0]
```

---

### 3.4 S型（緑 - Green）

**色**: `#00F000`

**回転状態0（水平）**:
```
[0, 0, 0, 0]
[0, 0, 1, 1]
[0, 1, 1, 0]
[0, 0, 0, 0]
```

**回転状態1（垂直）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[0, 1, 1, 0]
[0, 0, 1, 0]
```

**回転状態2（水平）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[0, 0, 1, 1]
[0, 1, 1, 0]
```

**回転状態3（垂直）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[0, 1, 1, 0]
[0, 0, 1, 0]
```

---

### 3.5 Z型（赤 - Red）

**色**: `#F00000`

**回転状態0（水平）**:
```
[0, 0, 0, 0]
[0, 1, 1, 0]
[0, 0, 1, 1]
[0, 0, 0, 0]
```

**回転状態1（垂直）**:
```
[0, 0, 0, 0]
[0, 0, 1, 0]
[0, 1, 1, 0]
[0, 1, 0, 0]
```

**回転状態2（水平）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[0, 1, 1, 0]
[0, 0, 1, 1]
```

**回転状態3（垂直）**:
```
[0, 0, 0, 0]
[0, 0, 1, 0]
[0, 1, 1, 0]
[0, 1, 0, 0]
```

---

### 3.6 J型（青 - Blue）

**色**: `#0000F0`

**回転状態0（J字上向き）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[0, 1, 1, 1]
[0, 0, 0, 0]
```

**回転状態1（J字右向き）**:
```
[0, 0, 0, 0]
[0, 0, 1, 0]
[0, 0, 1, 0]
[0, 1, 1, 0]
```

**回転状態2（J字下向き）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[0, 1, 1, 1]
[0, 0, 0, 1]
```

**回転状態3（J字左向き）**:
```
[0, 0, 0, 0]
[0, 1, 1, 0]
[0, 1, 0, 0]
[0, 1, 0, 0]
```

---

### 3.7 L型（オレンジ - Orange）

**色**: `#F0A000`

**回転状態0（L字上向き）**:
```
[0, 0, 0, 0]
[0, 0, 0, 1]
[0, 1, 1, 1]
[0, 0, 0, 0]
```

**回転状態1（L字右向き）**:
```
[0, 0, 0, 0]
[0, 1, 1, 0]
[0, 0, 1, 0]
[0, 0, 1, 0]
```

**回転状態2（L字下向き）**:
```
[0, 0, 0, 0]
[0, 0, 0, 0]
[0, 1, 1, 1]
[0, 1, 0, 0]
```

**回転状態3（L字左向き）**:
```
[0, 0, 0, 0]
[0, 1, 0, 0]
[0, 1, 0, 0]
[0, 1, 1, 0]
```

---

## 4. JavaScript実装例

### 4.1 完全なデータ定義

```javascript
const TETROMINOS = {
  'I': {
    shape: [
      [
        [0, 0, 0, 0],
        [1, 1, 1, 1],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      [
        [0, 0, 1, 0],
        [0, 0, 1, 0],
        [0, 0, 1, 0],
        [0, 0, 1, 0]
      ],
      [
        [0, 0, 0, 0],
        [0, 0, 0, 0],
        [1, 1, 1, 1],
        [0, 0, 0, 0]
      ],
      [
        [0, 1, 0, 0],
        [0, 1, 0, 0],
        [0, 1, 0, 0],
        [0, 1, 0, 0]
      ]
    ],
    color: '#00F0F0'
  },
  'O': {
    shape: [
      [
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0]
      ]
    ],
    color: '#F0F000'
  },
  // ... 残りのテトリミノ
};
```

### 4.2 使用例

```javascript
// I型テトリミノの回転状態0を取得
const iShape = TETROMINOS['I'].shape[0];
const iColor = TETROMINOS['I'].color;

// 回転処理
let currentRotation = 0;
function rotate() {
  currentRotation = (currentRotation + 1) % 4;
  const newShape = TETROMINOS[currentType].shape[currentRotation];
}
```

## 5. テトリミノオブジェクト構造

### 5.1 現在のテトリミノ状態

```javascript
const currentTetromino = {
  type: 'I',           // テトリミノの種類
  rotation: 0,         // 回転状態 (0-3)
  x: 3,               // ボード上のX座標
  y: 0,               // ボード上のY座標
  shape: [[...]],     // 現在の形状配列
  color: '#00F0F0'    // 色
};
```

### 5.2 初期化関数例

```javascript
function createTetromino(type) {
  const tetrominoData = TETROMINOS[type];
  return {
    type: type,
    rotation: 0,
    x: 3,  // ボード中央
    y: 0,  // 上部
    shape: tetrominoData.shape[0],
    color: tetrominoData.color
  };
}
```

## 6. ランダム生成仕様

### 6.1 7-Bag システム

標準的なテトリスでは、7種類のテトリミノをランダムに並べた「バッグ」を使用します。

```javascript
const TETROMINO_TYPES = ['I', 'O', 'T', 'S', 'Z', 'J', 'L'];

let tetrominoBag = [];

function getRandomTetromino() {
  if (tetrominoBag.length === 0) {
    // バッグが空の場合、新しいバッグを生成
    tetrominoBag = [...TETROMINO_TYPES];
    // Fisher-Yatesシャッフル
    for (let i = tetrominoBag.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [tetrominoBag[i], tetrominoBag[j]] =
        [tetrominoBag[j], tetrominoBag[i]];
    }
  }
  return tetrominoBag.pop();
}
```

### 6.2 完全ランダム（簡易版）

Phase 2では簡易的に完全ランダムでも可：

```javascript
function getRandomTetromino() {
  const types = ['I', 'O', 'T', 'S', 'Z', 'J', 'L'];
  const randomIndex = Math.floor(Math.random() * types.length);
  return types[randomIndex];
}
```

## 7. 色コード一覧

| テトリミノ | 色名 | HEX | RGB |
|----------|------|-----|-----|
| I | シアン | #00F0F0 | rgb(0, 240, 240) |
| O | 黄色 | #F0F000 | rgb(240, 240, 0) |
| T | 紫 | #A000F0 | rgb(160, 0, 240) |
| S | 緑 | #00F000 | rgb(0, 240, 0) |
| Z | 赤 | #F00000 | rgb(240, 0, 0) |
| J | 青 | #0000F0 | rgb(0, 0, 240) |
| L | オレンジ | #F0A000 | rgb(240, 160, 0) |

## 8. アクセシビリティ考慮

### 8.1 色覚多様性対応

色だけでなく、形状でも識別できるようになっています。将来的には以下の対応も検討：

- 境界線の強調
- パターン/テクスチャの追加
- ハイコントラストモード

### 8.2 代替色パレット（オプション）

```javascript
const COLOR_PALETTES = {
  default: { /* 上記の色 */ },
  colorblind: {
    'I': '#00D9FF',  // 明るいシアン
    'O': '#FFE119',  // 明るい黄色
    'T': '#9A6EFF',  // 明るい紫
    'S': '#42D4F4',  // 水色
    'Z': '#F032E6',  // マゼンタ
    'J': '#3CB44B',  // 緑
    'L': '#FF6F00'   // 濃いオレンジ
  }
};
```

## 9. テスト項目

- [ ] 全7種類のテトリミノが正しく定義されている
- [ ] 各テトリミノに4つの回転状態がある
- [ ] O型の全回転状態が同一である
- [ ] 各形状が4×4配列である
- [ ] 色コードが正しく設定されている
- [ ] ランダム生成が動作する
- [ ] 回転処理が正しく動作する

## 10. 参考資料

- [Tetris Wiki - Tetromino](https://tetris.wiki/Tetromino)
- [SRS - Super Rotation System](https://tetris.wiki/Super_Rotation_System)
- [テトリスガイドライン](https://tetris.wiki/Tetris_Guideline)

---

**更新履歴**:
- 2025-12-27: 初版作成
