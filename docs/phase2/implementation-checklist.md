# Phase 2: 実装チェックリスト

**作成日**: 2025-12-27
**対象フェーズ**: Phase 2 - コア機能実装
**目的**: 実装の抜け漏れを防ぎ、品質を確保する

## 📋 使い方

実装時に以下のチェックリストを順番に確認してください。各項目を完了したら `[ ]` を `[x]` に変更します。

---

## 1. 事前準備

### 1.1 ドキュメント確認
- [ ] `docs/phase2/technical-spec.md` を読んだ
- [ ] `docs/design/tetromino-data.md` を読んだ
- [ ] `docs/design/game-state.md` を読んだ
- [ ] `docs/phase2/api-specification.md` を読んだ

### 1.2 開発環境
- [ ] ブラウザのデベロッパーツールを開いた
- [ ] ローカルサーバーを起動した（`python3 -m http.server 8000 --directory public`）
- [ ] テスト用のコンソールログを準備した

---

## 2. データ定義

### 2.1 定数定義
- [ ] `CONFIG` オブジェクトを定義
  - [ ] `COLS: 10`
  - [ ] `ROWS: 20`
  - [ ] `BLOCK_SIZE: 30`
- [ ] `COLOR_MAP` オブジェクトを定義（0-7の色）
- [ ] `TYPE_TO_COLOR_ID` オブジェクトを定義

### 2.2 テトリミノデータ
- [ ] `TETROMINOS` オブジェクトを定義
  - [ ] I型（4つの回転状態）
  - [ ] O型（4つの回転状態）
  - [ ] T型（4つの回転状態）
  - [ ] S型（4つの回転状態）
  - [ ] Z型（4つの回転状態）
  - [ ] J型（4つの回転状態）
  - [ ] L型（4つの回転状態）

### 2.3 ゲーム状態
- [ ] `gameState` オブジェクトを定義
  - [ ] `isPlaying`
  - [ ] `isPaused`
  - [ ] `isGameOver`
  - [ ] `score`
  - [ ] `lines`
  - [ ] `level`
  - [ ] `board`
  - [ ] `currentTetromino`
  - [ ] `dropCounter`
  - [ ] `dropInterval`
  - [ ] `lastTime`

---

## 3. ボード管理機能

### 3.1 ボード初期化
- [ ] `createEmptyBoard()` 関数を実装
- [ ] 10×20の配列が生成されることを確認
- [ ] 全セルが0で初期化されることを確認

### 3.2 ボード描画
- [ ] `drawCell(x, y, colorId)` 関数を実装
  - [ ] 空セル（colorId=0）の描画
  - [ ] ブロック（colorId=1-7）の描画
  - [ ] 境界線の描画
- [ ] `drawBoard()` 関数を実装
  - [ ] 全セルを正しく描画
  - [ ] グリッド線が表示される

### 3.3 テスト
- [ ] ブラウザで空のボードが表示される
- [ ] グリッド線が正しく表示される
- [ ] 10×20のマス目が確認できる

---

## 4. テトリミノ機能

### 4.1 テトリミノ生成
- [ ] `getRandomTetrominoType()` 関数を実装
- [ ] `spawnTetromino(type)` 関数を実装
  - [ ] 正しい初期位置（x=3, y=0）
  - [ ] 正しい形状配列
  - [ ] 正しい色
  - [ ] 正しいcolorId

### 4.2 テトリミノ描画
- [ ] `drawTetromino(tetromino)` 関数を実装
  - [ ] 4×4の形状配列を正しく描画
  - [ ] ボード座標系との変換が正しい
  - [ ] 画面外の部分は描画しない

### 4.3 テスト
- [ ] ランダムでテトリミノが生成される
- [ ] 全7種類のテトリミノが生成できる
- [ ] テトリミノが画面上部に表示される
- [ ] 色が正しく表示される

---

## 5. 衝突判定機能

### 5.1 衝突判定実装
- [ ] `checkCollision(tetromino, offsetX, offsetY)` 関数を実装
  - [ ] 左壁判定（X < 0）
  - [ ] 右壁判定（X >= 10）
  - [ ] 床判定（Y >= 20）
  - [ ] ブロック判定（board[y][x] !== 0）

### 5.2 テスト
- [ ] 左端で左移動が止まる
- [ ] 右端で右移動が止まる
- [ ] 底で下移動が止まる
- [ ] 他のブロックで止まる

---

## 6. 移動・回転機能

### 6.1 移動機能実装
- [ ] `moveLeft()` 関数を実装
  - [ ] 衝突判定を実施
  - [ ] 移動可能ならX座標を-1
- [ ] `moveRight()` 関数を実装
  - [ ] 衝突判定を実施
  - [ ] 移動可能ならX座標を+1
- [ ] `moveDown()` 関数を実装
  - [ ] 衝突判定を実施
  - [ ] 移動可能ならY座標を+1
  - [ ] 移動不可なら `lockTetromino()` 呼び出し

### 6.2 回転機能実装
- [ ] `rotate()` 関数を実装
  - [ ] 回転状態を+1（0-3でループ）
  - [ ] 新しい形状配列を取得
  - [ ] 衝突判定を実施
  - [ ] 回転可能なら形状を更新

### 6.3 ハードドロップ実装
- [ ] `hardDrop()` 関数を実装
  - [ ] 底まで一気に移動
  - [ ] `lockTetromino()` 呼び出し

### 6.4 テスト
- [ ] ←キーで左移動
- [ ] →キーで右移動
- [ ] ↓キーで下移動
- [ ] ↑キーで回転
- [ ] スペースキーでハードドロップ
- [ ] 各操作が正しく動作する

---

## 7. テトリミノ固定機能

### 7.1 固定処理実装
- [ ] `lockTetromino()` 関数を実装
  - [ ] テトリミノの形状をボードに書き込む
  - [ ] colorIdを使用
  - [ ] 新しいテトリミノを生成
  - [ ] ゲームオーバー判定

### 7.2 テスト
- [ ] 底に着いたら固定される
- [ ] ボードに正しく反映される
- [ ] 新しいテトリミノが生成される
- [ ] 固定されたブロックが残る

---

## 8. ゲームループ

### 8.1 ゲームループ実装
- [ ] `gameLoop(time)` 関数を実装
  - [ ] requestAnimationFrameで呼び出し
  - [ ] deltaTime計算
  - [ ] update()呼び出し
  - [ ] draw()呼び出し

### 8.2 更新処理実装
- [ ] `update(deltaTime)` 関数を実装
  - [ ] dropCounterを加算
  - [ ] dropIntervalを超えたらmoveDown()
  - [ ] カウンターをリセット

### 8.3 描画処理実装
- [ ] `draw()` 関数を実装
  - [ ] キャンバスクリア
  - [ ] drawBoard()呼び出し
  - [ ] drawTetromino()呼び出し

### 8.4 テスト
- [ ] ゲームループが60FPSで動作
- [ ] 自動落下が1秒ごとに発生
- [ ] 画面が正しく更新される

---

## 9. 入力処理

### 9.1 キーボード入力実装
- [ ] `handleKeyPress(event)` 関数を実装
  - [ ] ArrowLeft → moveLeft()
  - [ ] ArrowRight → moveRight()
  - [ ] ArrowDown → moveDown()
  - [ ] ArrowUp / X → rotate()
  - [ ] Space → hardDrop()
- [ ] `initInputHandlers()` 関数を実装
  - [ ] keydownイベントリスナー登録

### 9.2 テスト
- [ ] 全てのキー入力が反応する
- [ ] 入力遅延が50ms以内
- [ ] 連続入力が正しく処理される

---

## 10. UI更新

### 10.1 スコア表示
- [ ] `updateUI()` 関数を実装
  - [ ] スコア表示更新
  - [ ] レベル表示更新
  - [ ] ライン数表示更新

### 10.2 テスト
- [ ] スコアが画面に表示される
- [ ] レベルが画面に表示される
- [ ] ライン数が画面に表示される

---

## 11. ゲーム開始・終了

### 11.1 ゲーム開始
- [ ] `startGame()` 関数を実装（または `init()`を拡張）
  - [ ] ゲーム状態を初期化
  - [ ] ボードをクリア
  - [ ] 最初のテトリミノを生成
  - [ ] ゲームループを開始

### 11.2 ゲームオーバー
- [ ] `gameOver()` 関数を実装
  - [ ] isGameOverをtrue
  - [ ] ゲームループを停止
  - [ ] メッセージ表示

### 11.3 テスト
- [ ] ページ読み込み時にゲームが開始される
- [ ] ゲームオーバー時に停止する
- [ ] メッセージが表示される

---

## 12. デバッグ・最適化

### 12.1 コンソールログ
- [ ] 主要な処理にconsole.logを追加
- [ ] エラーにconsole.errorを追加
- [ ] 警告にconsole.warnを追加

### 12.2 パフォーマンス確認
- [ ] ブラウザのPerformance Monitorで確認
- [ ] FPSが60を維持
- [ ] メモリリークがない

### 12.3 クロスブラウザテスト
- [ ] Chrome で動作確認
- [ ] Firefox で動作確認
- [ ] Safari で動作確認
- [ ] Edge で動作確認

---

## 13. コード品質

### 13.1 コードレビュー
- [ ] 関数名が明確
- [ ] 変数名が明確
- [ ] マジックナンバーを避けている
- [ ] 適切なコメントがある

### 13.2 エラー処理
- [ ] 境界値チェックがある
- [ ] nullチェックがある
- [ ] try-catchが必要な箇所にある

### 13.3 コードフォーマット
- [ ] インデントが統一されている
- [ ] セミコロンが統一されている
- [ ] 括弧のスタイルが統一されている

---

## 14. ドキュメント更新

### 14.1 コード内ドキュメント
- [ ] 各関数にJSDocコメント追加
- [ ] 複雑な処理に説明コメント追加

### 14.2 README更新
- [ ] Phase 2完了を記録
- [ ] 開発状況を更新

---

## 15. 最終確認

### 15.1 機能テスト
- [ ] 全7種類のテトリミノが生成される
- [ ] テトリミノが正しく描画される
- [ ] 左右移動が動作する
- [ ] 回転が動作する
- [ ] 自動落下が動作する
- [ ] ハードドロップが動作する
- [ ] 衝突判定が正しい
- [ ] テトリミノ固定が動作する
- [ ] 新しいテトリミノが生成される

### 15.2 パフォーマンステスト
- [ ] 60 FPS維持
- [ ] 入力遅延50ms以内
- [ ] メモリリーク なし

### 15.3 ユーザビリティテスト
- [ ] 操作が直感的
- [ ] 反応が速い
- [ ] 視認性が良い

---

## 16. Git コミット

### 16.1 コミット前確認
- [ ] 不要なconsole.logを削除（またはコメントアウト）
- [ ] デバッグコードを削除
- [ ] フォーマットを整える

### 16.2 コミット
- [ ] ステージング: `git add public/js/game.js`
- [ ] コミット: `git commit -m "feat: Implement Phase 2 core features"`
- [ ] プッシュ: `git push`

---

## 17. Phase 3への準備

### 17.1 確認事項
- [ ] Phase 2の全機能が動作している
- [ ] バグが修正されている
- [ ] ドキュメントが更新されている

### 17.2 次フェーズの計画
- [ ] Phase 3の仕様書を読む
- [ ] 実装計画を立てる

---

## ✅ 完了条件

以下の全てを満たしたらPhase 2完了：

1. ✅ 全てのチェック項目が完了している
2. ✅ テトリスの基本的なゲームプレイが可能
3. ✅ パフォーマンス目標を達成している
4. ✅ クロスブラウザで動作する
5. ✅ コードがクリーンで保守可能

---

**更新履歴**:
- 2025-12-27: 初版作成
